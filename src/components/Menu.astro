---
import MenuButton from "./MenuButton.astro";
const currentPath = Astro.url.pathname;
---

<MenuButton
  id="menu-button"
  aria-haspopup="menu"
  aria-controls="main-menu"
  aria-expanded="false"
  title="Toggle menu"
/>
<menu id="main-menu">
  <li>
    <a class:list={[{ active: currentPath.startsWith("/blog") }]} href="/blog"
      >Blog</a
    >
  </li>
  <li>
    <a
      class:list={[{ active: currentPath.startsWith("/mind-map") }]}
      href="/mind-map">Mind-map</a
    >
  </li>
  <li>
    <a class:list={[{ active: currentPath.startsWith("/about") }]} href="/about"
      >About</a
    >
  </li>
</menu>

<script>
  const button = document.querySelector("#menu-button");

  if (button) {
    const onChange = () => {
      const current =
        button.getAttribute("aria-expanded") === "true" ? true : false;
      button.setAttribute("aria-expanded", String(!current));
    };
    button.addEventListener("click", onChange);
  }
</script>

<style>
  menu {
    flex: 1 0 100%;
    display: none;
    flex-flow: column wrap;
    font-variation-settings: "CASL" 1;
    font-family: "Silkscreen", monospace;
    gap: 1.5em;
    padding: 0;
    margin-block: 2rem 0;
    list-style: none;
    text-align: center;
    > li {
      list-style: none;
      margin: 0;
    }
  }

  #menu-button {
    min-block-size: revert;
    min-inline-size: revert;
    padding: 0;

    &[aria-expanded="true"] {
      ~ menu {
        display: flex;
      }
    }

    &:before,
    &::after {
      content: none;
    }
  }

  a {
    color: var(--color-menu);
    text-shadow: 1px 1px 0px var(--color-menu-shadow);
    white-space: nowrap;
    transition: text-decoration-color 250ms cubic-bezier(0.65, 0, 0.35, 1);
    text-decoration-color: transparent;
    &:hover:not(.active) {
      text-decoration-style: dashed;
      text-decoration-color: currentColor;
    }
    &.active {
      text-decoration-color: currentColor;
      text-decoration-style: solid;
      text-decoration-line: underline;
      text-decoration-thickness: var(--link-hover-decoration-thickness);
    }
  }

  @container header (width > 50ch) {
    menu {
      display: flex;
      flex-flow: row nowrap;
      flex: 0 0 auto;
      margin: 0;
    }

    #menu-button {
      &[aria-expanded] {
        display: none;
      }
    }
  }
</style>
